<!doctype html>
<html lang="zxx">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>RoyalRetreat</title>
    <link rel="icon" href="img/favicon.png">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- animate CSS -->
    <link rel="stylesheet" href="css/animate.css">
    <!-- owl carousel CSS -->
    <link rel="stylesheet" href="css/owl.carousel.min.css">
    <!-- nice select CSS -->
    <link rel="stylesheet" href="css/nice-select.css">
    <!-- font awesome CSS -->
    <link rel="stylesheet" href="css/all.css">
    <!-- flaticon CSS -->
    <link rel="stylesheet" href="css/flaticon.css">
    <link rel="stylesheet" href="css/themify-icons.css">
    <!-- font awesome CSS -->
    <link rel="stylesheet" href="css/magnific-popup.css">
    <!-- swiper CSS -->
    <link rel="stylesheet" href="css/slick.css">
    <link rel="stylesheet" href="css/price_rangs.css">
    <!-- style CSS -->
    <link rel="stylesheet" href="css/style.css">


    <style>
        .nice-select .list {
            max-height: none;
            /* Remove the max height to allow vertical display */
        }

        .nice-select .option {
            display: block;
            /* Display options as blocks */
            width: 100%;
            /* Width to fill the container */
        }

        /* Style for the search input */
        .search-input {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 8px 12px;
            transition: border-color 0.3s ease;
        }

        /* Style for the search input */
        .search-input {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 8px 12px;
            transition: border-color 0.3s ease;
            outline: none;
            /* Remove default outline */
        }

        /* Add border when input is focused */
        .search-input:focus {
            border-color: #007bff;
            /* Change to desired focus color */
        }

        /* Style for the search icon */
        .input-group-text {
            background-color: #f8f9fa;
            /* Adjust background color as needed */
            border: 1px solid #ced4da;
            /* Adjust border color as needed */
            border-radius: 5px 0 0 5px;
            transition: background-color 0.3s ease;
        }

        /* Hover effect for the search icon */
        .input-group-text:hover {
            background-color: #007bff;
            /* Change to desired hover color */
            color: #fff;

            /* Change to desired text color on hover */
            .pagination-wrapper {
                margin-top: 20px;
                text-align: center;
            }

            .pagination {
                display: inline-block;
                padding-left: 0;
                margin: 20px 0;
                border-radius: 0.25rem;
            }

            .page-item {
                display: inline;
            }

            .page-link {
                position: relative;
                display: block;
                padding: 0.5rem 0.75rem;
                margin-left: -1px;
                line-height: 1.25;
                color: #007bff;
                background-color: #fff;
                border: 1px solid #dee2e6;
            }

            .page-link:hover {
                z-index: 2;
                color: #0056b3;
                text-decoration: none;
                background-color: #e9ecef;
                border-color: #dee2e6;
            }

            .page-item.active .page-link {
                z-index: 1;
                color: #fff;
                background-color: #007bff;
                border-color: #007bff;
            }

            .page-item.disabled .page-link {
                color: #6c757d;
                pointer-events: none;
                cursor: auto;
                background-color: #fff;
                border-color: #dee2e6;
            }

            .page-link:focus,
            .page-link:hover {
                text-decoration: none;
            }

            .page-link:not(:disabled):not(.disabled) {
                cursor: pointer;
            }

            .page-link i {
                font-size: 1.2em;
            }

            .pagination>li>a {
                border-radius: 0 !important;
                margin-right: 5px;
                min-width: 40px;
            }

        }

        .button-container {
            display: flex;
            align-items: center;
        }

        .add_cart {
            margin-right: 10px;
            /* Adjust spacing as needed */
        }

        .ti-heart {
            font-size: 1.5em;
            /* Adjust size as needed */
        }
    </style>
</head>

<body>
    <!--::header part start::-->
    <header class="main_menu home_menu">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-12">
                    <nav class="navbar navbar-expand-lg navbar-light">
                        <a class="navbar-brand" href="index.html"> <img src="" alt=""> </a>
                        <button class="navbar-toggler" type="button" data-toggle="collapse"
                            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                            <span class="menu_icon"><i class="fas fa-bars"></i></span>
                        </button>

                        <div class="collapse navbar-collapse main-menu-item" id="navbarSupportedContent">
                            <ul class="navbar-nav">
                                <li class="nav-item">
                                    <a class="nav-link" href="/">HOME</a>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link" href="shop" id="navbarDropdown_1">
                                        SHOP
                                    </a>
                                    <!-- <div class="dropdown-menu" aria-labelledby="navbarDropdown_1">
                                        <a class="dropdown-item" href="category.html"> SHOP CATEGORY</a>
                                        <a class="dropdown-item" href="single-product.html">product details</a>
                                        
                                    </div> -->
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link " href="blog.html" id="navbarDropdown_3">
                                        ABOUT
                                    </a>
                                    <!-- <div class="dropdown-menu" aria-labelledby="navbarDropdown_2">
                                        <a class="dropdown-item" href="login.html"> login</a>
                                        <a class="dropdown-item" href="tracking.html">tracking</a>
                                        <a class="dropdown-item" href="checkout.html">product checkout</a>
                                        <a class="dropdown-item" href="cart.html">shopping cart</a>
                                        <a class="dropdown-item" href="confirmation.html">confirmation</a>
                                        <a class="dropdown-item" href="elements.html">elements</a>
                                    </div> -->
                                </li>


                                <li class="nav-item">
                                    <a class="nav-link" href="contact.html">CONTACT</a>
                                </li>

                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="blog.html" id="navbarDropdown_2"
                                        role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <%= locals.User ? User.name.toUpperCase() : "PROFILE" %>
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="navbarDropdown_2">
                                        <% if (locals.User) { %>
                                            <a class="dropdown-item" href="userProfile">MY PROFILE</a>
                                            <a class="dropdown-item" href="logout">LOGOUT</a>
                                            <% } else { %>

                                                <a class="dropdown-item" href="login">LOGIN</a>
                                                <% } %>
                                                    <!-- <a class="dropdown-item" href="single-blog.html">Single blog</a> -->
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="hearer_icon d-flex">
                            <a id="search_1" href="javascript:void(0)"><i class="ti-search"></i></a>
                            <a href="wishlist"><i class="ti-heart"></i></a>
                            <div class="dropdown cart">
                                <a href="cart" role="button">
                                    <i class="fas fa-cart-plus"></i>
                                </a>
                            </div>
                        </div>
                    </nav>
                </div>
            </div>
        </div>
        <div class="search_input" id="search_input_box">
            <div class="container ">
                <form class="d-flex justify-content-between search-inner">
                    <input type="text" class="form-control" id="search_input" placeholder="Search Here">
                    <button type="submit" class="btn"></button>
                    <span class="ti-close" id="close_search" title="Close Search"></span>
                </form>
            </div>
        </div>
    </header>
    <!-- Header part end-->

    <!--================Home Banner Area =================-->
    <!-- breadcrumb start-->
    <section class="breadcrumb breadcrumb_bg">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="breadcrumb_iner">
                        <div class="breadcrumb_iner_item">
                            <h2>SHOP CATEGORY</h2>
                            <p>HOME<span>-</span> SHOP</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- breadcrumb start-->



    <!--================Category Product Area =================-->
    <section class="cat_product_area section_padding">
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="product_top_bar d-flex align-items-center">




                                <!-- Category filter -->
                                <div class="single_product_menu d-flex" style="margin-left: 36px;">
                                    <h5 style="color: transparent;">:</h5>
                                    <select id="categoryFilter">
                                        <option value="" data-display="CATEGORIES">CATEGORIES</option>
                                        <% categories.forEach(category=> { %>
                                            <option value="<%= category._id %>" <% if
                                                (selectedCategoryId===category._id.toString()) { %>selected<% } %>>
                                                    <%= category.name %>
                                            </option>
                                            <% }) %>
                                    </select>
                                </div>

                                <!-- Price filter -->
                                <div class="single_product_menu d-flex" style="margin-left: 82px;">
                                    <h5 style="color: transparent;">:</h5>
                                    <select id="priceFilter">
                                        <option value="" data-display="PRICE">PRICE</option>

                                    </select>
                                </div>

                                <!-- Search input -->
                                <div class="single_product_menu d-flex" style="margin-left: 5%;">
                                    <div class="input-group" style="width: 400px;"> <!-- Adjust width as needed -->
                                        <div class="input-group-prepend">
                                            <span class="input-group-text" id="inputGroupPrepend"><i
                                                    class="ti-search"></i></span>
                                        </div>
                                        <input type="text" class="form-control search-input"
                                            placeholder="Search here..." aria-describedby="inputGroupPrepend">
                                    </div>
                                </div>



                                <!-- Product count -->
                                <div class="single_product_menu" style="margin-left: 10%;">
                                    <p style="font-weight: 300;"><span>
                                            [<%= products.length %>
                                        </span> Products Found.]</p>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="row align-items-center latest_product_inner">
                        <% if (products.length> 0) { %>
                            <% for (let productData of products) { %>
                                <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                                    <div class="single_product_item">

                                        <a href="/singleProduct?productId=<%= productData._id %>">
                                            <img src="/resizedImages/<%= productData.image[0] %>"
                                                alt="<%= productData.name %>" class="img-fluid">
                                        </a>

                                        <div class="single_product_text">
                                            <h6 class="mt-3">
                                                <%= productData.name %>
                                            </h6>
                                            <h6>
                                                <%= productData.category?.name %>
                                            </h6>
                                            <span class="stext-105 cl3">
                                                <% if (productData.offer || productData.category?.offer) { %>
                                                    <span>
                                                        <b style="color: rgb(27, 218, 68); font-size: 16px;">₹ <%= productData.offerPrice %></b>
                                                    </span>
                                                    <span style="text-decoration: line-through; color: red;">₹ <%= productData.price %></span>
                                                    <% if (productData.offer) { %>
                                                        <span style="color: red; font-weight: 500;"><%= productData.offer.percentage %> % OFF</span>
                                                    <% } else { %>
                                                        <span style="color: red; font-weight: 500;"><%= productData.category.offer.percentage %> % OFF</span>
                                                    <% } %>
                                                <% } else { %>
                                                    <b>₹ <%= productData.price %></b>
                                                <% } %>
                                            </span>
                                            

                                            <h3></h3>
                                            <div class="button-container">
                                                <a href="#" class="add_cart"
                                                    onclick="addToCart(event, '<%= productData._id %>')"
                                                    style="font-size: medium;">+ Add to Cart
                                                </a>

                                                <a href="#" style="margin-left: 40px;"
                                                    onclick="addToWishlist('<%= productData._id %>')"><i
                                                        class="ti-heart"></i></a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <% } %>
                                    <% } else { %>
                                        <div class="col-md-12">
                                            <p>No listed products available.</p>
                                        </div>
                                        <% } %>
                    </div>
                </div>
            </div>
            <div class="col-lg-12">
                <div class="pagination-wrapper">
                    <nav aria-label="Page navigation">
                        <ul class="pagination justify-content-center">
                            <li class="page-item">
                                <% if (currentPage > 1) { %>
                                    <a class="page-link" href="?page=<%= currentPage - 1 %>" aria-label="Previous">
                                        <i class="ti-angle-double-left"></i>
                                    </a>
                                <% } %>
                              
                            </li>
                           
                            <% for (let i = 1; i <= totalPages; i++) { %>
                            <li class="page-item">
                                    <% if (i === currentPage) { %>
                                        <span class="page-link"><%= i %></span>
                                    <% } else { %>
                                        <a class="page-link" href="?page=<%= i %>"><%= i %></a>
                                    <% } %>
                                    
                                </li>
                                <% } %>
                          
                            <li class="page-item">
                                <% if (currentPage < totalPages) { %>
                                    <a class="page-link" href="?page=<%= currentPage + 1 %>" aria-label="Next">
                                        <i class="ti-angle-double-right"></i>
                                    </a>
                                    
                                <% } %>
                              
                            </li>
                        </ul>
                    </nav>
                </div>
                <!-- Add pagination links above or below the product list -->


            </div>

        </div>
    </section>

    <!--================End Category Product Area =================-->

    <!-- product_list part start-->
    <!-- <section class="product_list best_seller">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-12">
                    <div class="section_tittle text-center">
                        <h2>Best Sellers <span>shop</span></h2>
                    </div>
                </div>
            </div>
            <div class="row align-items-center justify-content-between">
                <div class="col-lg-12">
                    <div class="best_product_slider owl-carousel">
                        <div class="single_product_item">
                            <img src="img/product/product_1.png" alt="">
                            <div class="single_product_text">
                                <h4>Quartz Belt Watch</h4>
                                <h3>$150.00</h3>
                            </div>
                        </div>
                        <div class="single_product_item">
                            <img src="img/product/product_2.png" alt="">
                            <div class="single_product_text">
                                <h4>Quartz Belt Watch</h4>
                                <h3>$150.00</h3>
                            </div>
                        </div>
                        <div class="single_product_item">
                            <img src="img/product/product_3.png" alt="">
                            <div class="single_product_text">
                                <h4>Quartz Belt Watch</h4>
                                <h3>$150.00</h3>
                            </div>
                        </div>
                        <div class="single_product_item">
                            <img src="img/product/product_4.png" alt="">
                            <div class="single_product_text">
                                <h4>Quartz Belt Watch</h4>
                                <h3>$150.00</h3>
                            </div>
                        </div>
                        <div class="single_product_item">
                            <img src="img/product/product_5.png" alt="">
                            <div class="single_product_text">
                                <h4>Quartz Belt Watch</h4>
                                <h3>$150.00</h3>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section> -->
    <!-- product_list part end-->

    <!--::footer_part start::-->
    <footer class="footer_part">
        <div class="container">
            <div class="row justify-content-around">
                <div class="col-sm-6 col-lg-2">
                    <div class="single_footer_part">
                        <h4>Top Products</h4>
                        <ul class="list-unstyled">
                            <li><a href="">Managed Website</a></li>
                            <li><a href="">Manage Reputation</a></li>
                            <li><a href="">Power Tools</a></li>
                            <li><a href="">Marketing Service</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-2">
                    <div class="single_footer_part">
                        <h4>Quick Links</h4>
                        <ul class="list-unstyled">
                            <li><a href="">Jobs</a></li>
                            <li><a href="">Brand Assets</a></li>
                            <li><a href="">Investor Relations</a></li>
                            <li><a href="">Terms of Service</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-2">
                    <div class="single_footer_part">
                        <h4>Features</h4>
                        <ul class="list-unstyled">
                            <li><a href="">Jobs</a></li>
                            <li><a href="">Brand Assets</a></li>
                            <li><a href="">Investor Relations</a></li>
                            <li><a href="">Terms of Service</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-2">
                    <div class="single_footer_part">
                        <h4>Resources</h4>
                        <ul class="list-unstyled">
                            <li><a href="">Guides</a></li>
                            <li><a href="">Research</a></li>
                            <li><a href="">Experts</a></li>
                            <li><a href="">Agencies</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-4">
                    <div class="single_footer_part">
                        <h4>Newsletter</h4>
                        <p>Heaven fruitful doesn't over lesser in days. Appear creeping
                        </p>
                        <div id="mc_embed_signup">
                            <form target="_blank"
                                action="https://spondonit.us12.list-manage.com/subscribe/post?u=1462626880ade1ac87bd9c93a&amp;id=92a4423d01"
                                method="get" class="subscribe_form relative mail_part">
                                <input type="email" name="email" id="newsletter-form-email" placeholder="Email Address"
                                    class="placeholder hide-on-focus" onfocus="this.placeholder = ''"
                                    onblur="this.placeholder = ' Email Address '">
                                <button type="submit" name="submit" id="newsletter-submit"
                                    class="email_icon newsletter-submit button-contactForm">subscribe</button>
                                <div class="mt-10 info"></div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div class="copyright_part">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8">
                        <div class="copyright_text">
                            <P><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                                Copyright &copy;
                                <script>document.write(new Date().getFullYear());</script> All rights reserved | This
                                template is made with <i class="ti-heart" aria-hidden="true"></i> by <a
                                    href="https://colorlib.com" target="_blank">Colorlib</a>
                                <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                            </P>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="footer_icon social_icon">
                            <ul class="list-unstyled">
                                <li><a href="#" class="single_social_icon"><i class="fab fa-facebook-f"></i></a></li>
                                <li><a href="#" class="single_social_icon"><i class="fab fa-twitter"></i></a></li>
                                <li><a href="#" class="single_social_icon"><i class="fas fa-globe"></i></a></li>
                                <li><a href="#" class="single_social_icon"><i class="fab fa-behance"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!--::footer_part end::-->

    <!-- jquery plugins here-->
    <script src="js/jquery-1.12.1.min.js"></script>
    <!-- popper js -->
    <script src="js/popper.min.js"></script>
    <!-- bootstrap js -->
    <script src="js/bootstrap.min.js"></script>
    <!-- easing js -->
    <script src="js/jquery.magnific-popup.js"></script>
    <!-- swiper js -->
    <script src="js/swiper.min.js"></script>
    <!-- swiper js -->
    <script src="js/masonry.pkgd.js"></script>
    <!-- particles js -->
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <!-- slick js -->
    <script src="js/slick.min.js"></script>
    <script src="js/jquery.counterup.min.js"></script>
    <script src="js/waypoints.min.js"></script>
    <script src="js/contact.js"></script>
    <script src="js/jquery.ajaxchimp.min.js"></script>
    <script src="js/jquery.form.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/mail-script.js"></script>
    <script src="js/stellar.js"></script>
    <script src="js/price_rangs.js"></script>
    <!-- custom js -->
    <script src="js/custom.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>


    <script>
        $(document).ready(function () {
            $('#categoryFilter').change(function () {
                var categoryId = $(this).val();
                if (categoryId) {
                    window.location.href = '/shop?category=' + categoryId;
                } else {
                    window.location.href = '/shop';
                }
            });
        }); 
    </script>
    <script>
        async function addToCart(event, product) {
            try {
                event.preventDefault();
                const quantity = 1;
                const data = {
                    productId: product,
                    quantity: quantity
                };
                const response = await fetch('/addToCart', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(data),
                });

                if (response.ok) {
                    const responseData = await response.json();
                    if (responseData.success) {
                        // Show success SweetAlert with two buttons
                        Swal.fire({
                            icon: 'success',
                            title: 'Product added to cart',
                            showCancelButton: true,
                            confirmButtonText: 'OK',
                            cancelButtonText: 'Go to Cart',
                            customClass: {
                                popup: 'swal2-custom-size',
                            },
                        }).then((result) => {
                            if (result.isConfirmed) {
                                // Handle OK button click: No action needed
                            } else if (result.dismiss === Swal.DismissReason.cancel) {
                                // Handle "Go to Cart" button click
                                window.location.href = '/cart';
                            }
                        });
                    } else {
                        // Show error SweetAlert with specific message
                        Swal.fire({
                            icon: 'error',
                            title: 'Failed to add product to cart',
                            text: responseData.message || 'Please login and continue',
                            customClass: {
                                popup: 'swal2-custom-size',
                            },
                        });
                    }
                } else {
                    console.error('Failed to add product to cart:', response.status);
                }
            } catch (error) {
                console.error('Error adding product to cart:', error);
            }
        }
    </script>


    <script>
        async function addToWishlist(productId) {
            try {
                const response = await fetch('/wishlist', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ productId }),
                });

                const data = await response.json();

                if (data.success) {
                    // Show success message using SweetAlert with custom class
                    Swal.fire({
                        icon: 'success',
                        title: 'Success!',
                        text: 'Product added to wishlist',
                        customClass: {
                            popup: 'custom-popup-class',
                            confirmButton: 'custom-confirm-button-class',
                            cancelButton: 'custom-cancel-button-class'
                        }
                    });
                    // Change heart icon color to red
                    document.getElementById('heartIcon').classList.add('full-heart');
                } else {
                    // Show error message using SweetAlert with custom class
                    Swal.fire({
                        icon: 'error',
                        title: 'Error!',
                        text: data.message,
                        customClass: {
                            popup: 'custom-popup-class',
                            confirmButton: 'custom-confirm-button-class',
                            cancelButton: 'custom-cancel-button-class'
                        }
                    });
                }
            } catch (error) {
                console.error('Error adding product to wishlist:', error);
            }
        }
    </script>

    <style>
        .custom-popup-class {
            width: 400px;
            font-size: 14px;
            height: auto;
        }
    </style>
</body>

</html>