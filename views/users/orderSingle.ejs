<!--Website: wwww.codingdung.com-->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RoyalRetreat</title>
    <link rel="stylesheet" href="css/userProfile">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>RoyalRetreat</title>
    <link rel="icon" href="img/favicon.png">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- animate CSS -->
    <!-- <link rel="stylesheet" href="css/animate.css"> -->
    <!-- owl carousel CSS -->
    <!-- <link rel="stylesheet" href="css/owl.carousel.min.css"> -->
    <!-- font awesome CSS -->
    <link rel="stylesheet" href="css/all.css">
    <!-- flaticon CSS -->
    <!-- <link rel="stylesheet" href="css/flaticon.css"> -->
    <link rel="stylesheet" href="css/themify-icons.css">
    <!-- font awesome CSS -->
    <link rel="stylesheet" href="css/magnific-popup.css">
    <!-- swiper CSS -->
    <!-- <link rel="stylesheet" href="css/slick.css"> -->
    <!-- style CSS -->
    <link rel="stylesheet" href="css/style.css">


     <!-- google fonts -->
     <link rel="preconnect" href="https://fonts.googleapis.com">
     <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
     <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
 
     <!-- css link here  -->
     <link rel="stylesheet" href="/userAssets/css/swipper.css">
     <link rel="stylesheet" href="/userAssets/css/select2.css">
     <link rel="stylesheet" href="/userAssets/css/tailwind.css">
     <link rel="stylesheet" href="/userAssets/css/styles.css">
     <link rel="stylesheet" href="/userAssets/css/responsive.css">


</head>

<body>
    <header class="main_menu home_menu">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-12">
                    <nav class="navbar navbar-expand-lg navbar-light">
                        <a class="navbar-brand" href="index.html"> <img src="" alt=""> </a>
                        <button class="navbar-toggler" type="button" data-toggle="collapse"
                            data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                            aria-expanded="false" aria-label="Toggle navigation">
                            <span class="menu_icon"><i class="fas fa-bars"></i></span>
                        </button>

                        <div class="collapse navbar-collapse main-menu-item" id="navbarSupportedContent">
                            <ul class="navbar-nav">
                                <li class="nav-item">
                                    <a class="nav-link" href="/">HOME</a>
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link" href="shop" id="navbarDropdown_1">
                                        SHOP
                                    </a>
                                    <!-- <div class="dropdown-menu" aria-labelledby="navbarDropdown_1">
                                        <a class="dropdown-item" href="category.html"> SHOP CATEGORY</a>
                                        <a class="dropdown-item" href="single-product.html">product details</a>
                                        
                                    </div> -->
                                </li>
                                <li class="nav-item dropdown">
                                    <a class="nav-link " href="blog.html" id="navbarDropdown_3">
                                        ABOUT
                                    </a>
                                    <!-- <div class="dropdown-menu" aria-labelledby="navbarDropdown_2">
                                        <a class="dropdown-item" href="login.html"> login</a>
                                        <a class="dropdown-item" href="tracking.html">tracking</a>
                                        <a class="dropdown-item" href="checkout.html">product checkout</a>
                                        <a class="dropdown-item" href="cart.html">shopping cart</a>
                                        <a class="dropdown-item" href="confirmation.html">confirmation</a>
                                        <a class="dropdown-item" href="elements.html">elements</a>
                                    </div> -->
                                </li>


                                <li class="nav-item">
                                    <a class="nav-link" href="contact.html">CONTACT</a>
                                </li>

                                <li class="nav-item dropdown">
                                    <a class="nav-link dropdown-toggle" href="blog.html" id="navbarDropdown_2"
                                        role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                        <%= locals.User ? User.name.toUpperCase() : "PROFILE" %>
                                    </a>
                                    <div class="dropdown-menu" aria-labelledby="navbarDropdown_2">
                                        <% if (locals.User) { %>
                                            <a class="dropdown-item" href="userProfile">MY PROFILE</a>
                                            <a class="dropdown-item" href="logout">LOGOUT</a>

                                            <% } else { %>

                                                <a class="dropdown-item" href="login">LOGIN</a>
                                                <% } %>
                                                    <!-- <a class="dropdown-item" href="single-blog.html">Single blog</a> -->
                                    </div>
                                </li>
                            </ul>
                        </div>
                        <div class="hearer_icon d-flex">

                            <a href=""><i class="ti-heart"></i></a>
                            <div class="dropdown cart">
                                <a href="cart" role="button">
                                    <i class="fas fa-cart-plus"></i>
                                </a>
                            </div>
                        </div>
                    </nav>
                </div>
            </div>
        </div>

    </header>

    <section class="breadcrumb breadcrumb_bg">
        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8">
                    <div class="breadcrumb_iner">
                        <div class="breadcrumb_iner_item">
                            <h2>MY PROFILE</h2>
                            <p>HOME<span>-</span>ORDERS</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <div class="user bg-red-600">
        <div class="container">
            <div class="usermenu flex flex-col md:flex-row justify-between md:items-center">
                <!-- Tabs -->
                <ul id="tabs" class="inline-flex flex-col md:flex-row w-full">

                    <li >
                        <a id="default-tab" href="/userProfile" class="text-[#636270] font-medium p-5 border-b border-transparent hover:text-gray-black font-display">My Profile</a>
                    </li>

                    <li class="border-b-2 border-accents">
                        <a href="" class="text-[#636270] font-medium p-5 border-b border-transparent hover:text-gray-black font-display">Order History</a>
                    </li>
                    
                    <li>
                        <a href="/addressManage" class="text-[#636270] font-medium p-5 border-b border-transparent hover:text-gray-black">Address Manage</a>
                    </li>

                    <li>
                        <a href="/wishlist" class="text-[#636270] font-medium p-5 border-b border-transparent hover:text-gray-black font-display">Wishlist</a>
                    </li>
                    <li>
                        <a href="/wallet" class="text-[#636270] font-medium p-5 border-b border-transparent hover:text-gray-black font-display">Wallet</a>
                    </li>
                </ul>
                <a href="logout" class="font-display text-[16px] leading-[110%] font-medium capitalize text-[#636270] px-4 py-4 md:px-0">Logout</a>
            </div>
        </div>
    </div>


    <div class="container">
        <!-- Tab Contents -->
        <div id="tab-contents">

             <!-- Order Details start -->
             <div class="p-4">
                <div class="container pt-10 pb-20">
                    <div class="box">
                        <div class="">
                            <div class="flex flex-wrap justify-between items-center px-8 py-[30px]">
                                <h2 class="text-[#272343] font-display xl:text-[32px] text-[18px] font-semibold leading-[110%] capitalize">Order Details</h2>
                                <a href="/userOrders" class="btn_3 capitalize" style="font-size: 14px; border-radius: 5px;">back to List</a>
                            </div>
                            <hr class="my-0">
                            <div class="px-8 py-8 flex flex-col md:flex-row md:flex-wrap gap-6 xl:gap-2 xl:justify-between md:items-center">
                                <div class="flex-wrap">
                                    <p class="text-[#9A9CAA] font-display text-[14px] leading-[100%] capitalize pb-[10px]">Order ID:</p>
                                    <span class="text-gray-black font-display text-[20px] leading-[120%] font-medium"><%=order._id%></span>
                                </div>
                                <div class="flex-wrap">
                                    <p class="text-[#9A9CAA] font-display text-[14px] leading-[100%] capitalize pb-[10px]">Date:</p>
                                    <span class="text-gray-black font-display text-[20px] leading-[120%] font-medium"><%= order.date %></span>
                                </div>
                                <div class="flex-wrap">
                                    <p class="text-[#9A9CAA] font-display text-[14px] leading-[100%] capitalize pb-[10px]">Name:</p>
                                    <span class="text-gray-black font-display text-[20px] leading-[120%] font-medium"><%= order.user_name %></span>
                                </div>
                                <div class="flex-wrap">
                                    <p class="text-[#9A9CAA] font-display text-[14px] leading-[100%] capitalize pb-[10px]">Total Amount:</p>
                                    <span class="text-gray-black font-display text-[20px] leading-[120%] font-medium"><%= order.total_amount %></span>
                                </div>
                                <div class="flex-wrap">
                                    <p class="text-[#9A9CAA] font-display text-[14px] leading-[100%] capitalize pb-[10px]">Status:</p>
                                    <span class="text-gray-black font-display text-[20px] leading-[120%] font-medium"><%= item.ordered_status %></span>
                                </div>
                                <div class="flex-wrap">
                                    <p class="text-[#9A9CAA] font-display text-[14px] leading-[100%] capitalize pb-[10px]">Payment Method:</p>
                                    <span class="text-gray-black font-display text-[20px] leading-[120%] font-medium"><%= order.payment %></span>
                                </div>
                            </div>
                        </div>
                        <div class="w-full">
                            <div class="overflow-x-auto">
                                <table class="min-w-full leading-normal">
                                    <thead class="bg-off-white">
                                        <tr class="">
                                            <th class="pt-4 pb-4 px-8 border-b border-[#E1E3E6] text-left text-lg font-medium leading-[100%] text-[#272343] uppercase tracking-wider w-[305px]">
                                                Product
                                            </th>
                                            <th class="pt-4 pb-4 border-b border-[#E1E3E6] text-left text-lg font-medium leading-[100%] text-[#272343] uppercase tracking-wider w-[140px]">
                                                Price
                                            </th>
                                            <th class="pt-4 pb-4 border-b border-[#E1E3E6] text-left text-lg font-medium leading-[100%] text-[#272343] uppercase tracking-wider w-[145px]">
                                                Expected Delivery
                                            </th>
                                            <th class="pt-4 pb-4 border-b border-[#E1E3E6] text-left text-lg font-medium leading-[100%] text-[#272343] uppercase tracking-wider w-[175px]">
                                                TOTAL
                                            </th>
                                            <th class="pt-4 pb-4 border-b border-[#E1E3E6] text-left text-lg font-medium leading-[100%] text-[#272343] uppercase tracking-wider w-[295px]">
                                                Cancel / Return
                                            </th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                        <tr class="">
                                            <td class="text-sm px-6 pt-6">
                                                <div class="flex justify-between items-center">
                                                    <div class="flex items-center gap-3">
                                                        <div>
                                                            <img src="/resizedImages/<%= item.product_id.image[0] %>"
                                                                alt="" style="width: 100px; height: 75px;">
                                                        </div>

                                                        <p><%= item.product_id.name %> x <%= item.quantity %></p>

                                                    </div>

                                                </div>
                                            </td>
                                            <!-- <td> <%= item.quantity %></td> -->
                                            <td class="text-sm">
                                                <p class="mb-0"><%= item.product_id.price %></p>
                                            </td>
                                            <td class="text-sm" style="width: 25%;">
                                                <p> <%= moment( (order.expected_delivery)).format('dddd, MMMM Do YYYY') %></p>
                                            </td>
                                            <td class="text-sm">
                                                <p><%= order.total_amount %></p>
                                            </td>
                                            <td class="text-sm pt-6">
                                                <p style="color: red; font-weight: 500;"><%= item.ordered_status %></p><br>
                                                <a href="#" id="cancelOrderBtn" class="btn_3" style="font-size: 14px; border-radius: 5px;">CANCEL ORDER</a>
                                                <a href="#" id="returnOrderBtn" class="btn_3" style="font-size: 14px; border-radius: 5px;">RETURN ORDER</a><br><br>
                                            </td>
                                        </tr>

                                        

                                    </tbody>
                                </table>
                            </div>

                        </div>
                        <hr class="my-0">

                        <div class="px-8 py-8 flex flex-col md:flex-row md:flex-wrap gap-y-6 justify-between md:items-center">

                    
                            <div>
                                <h2 class="text-gray-black font-medium font-display xl:text-[32px] text-[20px] leading-[110%] capitalize">Shipping address</h2>
                                <p class="font-display text-[16px] leading-[120%] font-normal text-[#272343] pt-5 pb-2"><%= order.delivery_address %></p>
                               
                               
                            </div>

                            <div class="px-6 py-6 bg-off-white rounded-lg max-w-[348px] w-full">
                                <div class="">

                                    <div class="flex justify-between pb-4">
                                        <p>Subtotal</p>
                                        <p>$1,435.00</p>
                                    </div>
                                    <div class="flex justify-between pb-4">
                                        <p>discount</p>
                                        <p>26%</p>
                                    </div>
                                    <div class="flex justify-between">
                                        <p>shipping</p>
                                        <p>Free</p>
                                    </div>
                                    <hr>
                                    <div class="flex justify-between">
                                        <p class="text-[18px] font-display text-dark-gray ">Total:</p>
                                        <p class="text-[22px] font-display leading-[120%] font-sem">$1026.23</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Order Details end -->
            
            
        </div>
    </div>


     <!--::footer_part start::-->
     <footer class="footer_part">
        <div class="container">
            <div class="row justify-content-around">
                <div class="col-sm-6 col-lg-2">
                    <div class="single_footer_part">
                        <h4>Top Products</h4>
                        <ul class="list-unstyled">
                            <li><a href="">Managed Website</a></li>
                            <li><a href="">Manage Reputation</a></li>
                            <li><a href="">Power Tools</a></li>
                            <li><a href="">Marketing Service</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-2">
                    <div class="single_footer_part">
                        <h4>Quick Links</h4>
                        <ul class="list-unstyled">
                            <li><a href="">Jobs</a></li>
                            <li><a href="">Brand Assets</a></li>
                            <li><a href="">Investor Relations</a></li>
                            <li><a href="">Terms of Service</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-2">
                    <div class="single_footer_part">
                        <h4>Features</h4>
                        <ul class="list-unstyled">
                            <li><a href="">Jobs</a></li>
                            <li><a href="">Brand Assets</a></li>
                            <li><a href="">Investor Relations</a></li>
                            <li><a href="">Terms of Service</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-2">
                    <div class="single_footer_part">
                        <h4>Resources</h4>
                        <ul class="list-unstyled">
                            <li><a href="">Guides</a></li>
                            <li><a href="">Research</a></li>
                            <li><a href="">Experts</a></li>
                            <li><a href="">Agencies</a></li>
                        </ul>
                    </div>
                </div>
                <div class="col-sm-6 col-lg-4">
                    <div class="single_footer_part">
                        <h4>Newsletter</h4>
                        <p>Heaven fruitful doesn't over lesser in days. Appear creeping
                        </p>
                        <div id="mc_embed_signup">
                            <form target="_blank"
                                action="https://spondonit.us12.list-manage.com/subscribe/post?u=1462626880ade1ac87bd9c93a&amp;id=92a4423d01"
                                method="get" class="subscribe_form relative mail_part">
                                <input type="email" name="email" id="newsletter-form-email" placeholder="Email Address"
                                    class="placeholder hide-on-focus" onfocus="this.placeholder = ''"
                                    onblur="this.placeholder = ' Email Address '">
                                <button type="submit" name="submit" id="newsletter-submit"
                                    class="email_icon newsletter-submit button-contactForm">subscribe</button>
                                <div class="mt-10 info"></div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <div class="copyright_part">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8">
                        <div class="copyright_text">
                            <P><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                                Copyright &copy;
                                <script>document.write(new Date().getFullYear());</script> All rights reserved | This
                                template is made with <i class="ti-heart" aria-hidden="true"></i> by <a
                                    href="https://colorlib.com" target="_blank">Colorlib</a>
                                <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                            </P>
                        </div>
                    </div>
                    <div class="col-lg-4">
                        <div class="footer_icon social_icon">
                            <ul class="list-unstyled">
                                <li><a href="#" class="single_social_icon"><i class="fab fa-facebook-f"></i></a></li>
                                <li><a href="#" class="single_social_icon"><i class="fab fa-twitter"></i></a></li>
                                <li><a href="#" class="single_social_icon"><i class="fas fa-globe"></i></a></li>
                                <li><a href="#" class="single_social_icon"><i class="fab fa-behance"></i></a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!--::footer_part end::-->
    
    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript"></script>
    <!-- jquery plugins here-->
    <script src="js/jquery-1.12.1.min.js"></script>
    <!-- popper js -->
    <script src="js/popper.min.js"></script>
    <!-- bootstrap js -->
    <script src="js/bootstrap.min.js"></script>
    <!-- easing js -->
    <script src="js/jquery.magnific-popup.js"></script>
    <!-- swiper js -->
    <script src="js/swiper.min.js"></script>
    <!-- swiper js -->
    <script src="js/masonry.pkgd.js"></script>
    <!-- particles js -->
    <script src="js/owl.carousel.min.js"></script>
    <script src="js/jquery.nice-select.min.js"></script>
    <!-- slick js -->
    <script src="js/slick.min.js"></script>
    <script src="js/jquery.counterup.min.js"></script>
    <script src="js/waypoints.min.js"></script>
    <script src="js/contact.js"></script>
    <script src="js/jquery.ajaxchimp.min.js"></script>
    <script src="js/jquery.form.js"></script>
    <script src="js/jquery.validate.min.js"></script>
    <script src="js/mail-script.js"></script>
    <!-- custom js -->
    <script src="/userAssets/js/custom.js"></script>
    <script src="/userAssets/js/jquery.js"></script>
    <script src="/userAssets/js/swipper.js"></script>
    <script src="/userAssets/js/select2.js"></script>
    <script src="/userAssets/js/mixitUp.js"></script>
    <script src="/userAssets/js/app.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>







    <script>


        //----------------------------------------------------------CANCEL ORDER---------------------------------------------



        $(document).ready(function () {
            const orderStatus = '<%= item.ordered_status %>';
            const cancelOrderBtn = $('#cancelOrderBtn');

            // Check if the order status is 'placed' or 'shipped'
            if (orderStatus !== 'placed' && orderStatus !== 'shipped') {
                // Remove the "Cancel Order" button
                cancelOrderBtn.remove();
            } else {
                // Add a click event handler to the button
                cancelOrderBtn.on('click', function () {
                    const orderId = '<%= order._id %>';
                    const itemId = '<%= item._id %>';

                    Swal.fire({
                        title: 'Are you sure?',
                        text: 'You won\'t be able to revert this!',
                        icon: 'warning',
                        showCancelButton: true,
                        confirmButtonColor: '#3085d6',
                        cancelButtonColor: '#d33',
                        confirmButtonText: 'Yes, cancel it!'
                    }).then((result) => {
                        if (result.isConfirmed) {
                            // Handle cancel order logic here
                            $.post('/cancelOrder', { orderId: orderId, itemId: itemId }, function (response) {
                                if (response.success) {
                                    Swal.fire({
                                        title: 'Cancelled!',
                                        text: 'Your order has been cancelled.',
                                        icon: 'success'
                                    }).then(() => {
                                        window.location.reload(); // Reload the current page
                                    });
                                } else {
                                    Swal.fire({
                                        title: 'Success!',
                                        text: 'Requested for Order Cancel: ' + response.message,
                                        icon: 'success'
                                    }).then(() => {
                                        window.location.reload(); // Reload the current page
                                    });
                                }
                            });
                        }
                    });
                });
            }
        });
    </script>

    <script>
        const updatedStatusElement = document.getElementById(`status-${order._id}-${item._id}`);
        if (updatedStatusElement) {
            updatedStatusElement.innerText = 'request_cancellation';
        }

    </script>





    <script>

        //------------------------------------------------------------------RETURN ORDER--------------------------------------------------------
        $(document).ready(function () {
            const orderStatus = '<%= item.ordered_status %>';
            const returnOrderBtn = $('#returnOrderBtn');
            const returnPeriodDays = 7;

            function calculateExpiryDate(orderDate) {
                const expiryDate = new Date(orderDate);
                expiryDate.setDate(expiryDate.getDate() + returnPeriodDays);
                return expiryDate;
            }


            const orderDate = '<%= order.date %>';
            const expiryDate = calculateExpiryDate(orderDate);


            // Check if the order status is 'Out for delivery' or 'delivered'
            if (orderStatus !== 'Out for delivery' && orderStatus !== 'delivered') {
                // Remove the "Return Order" button
                returnOrderBtn.remove();
            } else {
                // Add a click event handler to the button
                returnOrderBtn.on('click', function () {
                    const orderId = '<%= order._id %>';
                    const itemId = '<%= item._id %>';
                

                    if (new Date() > expiryDate) {
       
                            returnOrderBtn.remove();
                    } else {
        
                        returnOrderBtn.on('click', function () {
                            if (['out_for_delivery', 'delivered'].includes('<%= item.ordered_status %>')) {
                        Swal.fire({
                            title: 'Are you sure?',
                            text: 'Do you want to return this order?',
                            icon: 'question',
                            showCancelButton: true,
                            confirmButtonColor: '#d33',
                            cancelButtonColor: '#3085d6',
                            confirmButtonText: 'Yes, return it!'
                        }).then((result) => {
                            if (result.isConfirmed) {
                                // Make an AJAX request to update the order status
                                $.post('/returnOrder', { orderId: orderId, itemId: itemId }, function (response) {
                                    if (response.success) {
                                        Swal.fire({
                                            title: 'Returned!',
                                            text: 'Your order has been returned.',
                                            icon: 'success'
                                        }).then(() => {
                                            window.location.reload(); // Reload the current page
                                        });
                                    } else {
                                        Swal.fire({
                                            title: 'Error!',
                                            text: 'Failed to return order. Error: ' + response.message,
                                            icon: 'error'
                                        });
                                    }
                                });
                            }
                        });
                    }
                    });
                }
                   
                });
            }
        });
    </script>

</body>

</html>